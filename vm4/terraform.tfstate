{
  "version": 4,
  "terraform_version": "1.5.7",
  "serial": 58,
  "lineage": "e9059027-495a-e614-d7ca-9e9b4f6391e7",
  "outputs": {
    "vm4_commands": {
      "value": {
        "connect_ssh": "ssh devops@192.168.88.140",
        "deploy_and_test": "make deploy-and-test",
        "quick_deploy": "make quick-deploy",
        "recreate_vm": "make recreate",
        "test_connection": "./test-ssh.sh"
      },
      "type": [
        "object",
        {
          "connect_ssh": "string",
          "deploy_and_test": "string",
          "quick_deploy": "string",
          "recreate_vm": "string",
          "test_connection": "string"
        }
      ]
    },
    "vm4_config": {
      "value": {
        "cores": 2,
        "disk_size_gb": 50,
        "memory_mb": 4096,
        "network_bridge": "vmbr0",
        "os_image": "ubuntu-22.04-cloud-vm4.img",
        "packages_count": 10
      },
      "type": [
        "object",
        {
          "cores": "number",
          "disk_size_gb": "number",
          "memory_mb": "number",
          "network_bridge": "string",
          "os_image": "string",
          "packages_count": "number"
        }
      ]
    },
    "vm4_info": {
      "value": {
        "created_at": "2025-10-28T09:37:40Z",
        "ip_address": "192.168.88.140",
        "name": "vm4-server",
        "ssh_command": "ssh devops@192.168.88.140",
        "status": "deployed",
        "vm_id": 740
      },
      "type": [
        "object",
        {
          "created_at": "string",
          "ip_address": "string",
          "name": "string",
          "ssh_command": "string",
          "status": "string",
          "vm_id": "number"
        }
      ]
    },
    "vm4_ssh_command": {
      "value": "ssh devops@192.168.88.140",
      "type": "string"
    },
    "vm4_testing": {
      "value": {
        "auto_validation": true,
        "makefile_cmds": [
          "make test-ssh",
          "make deploy-and-test"
        ],
        "ssh_test_enabled": true,
        "test_script": "./test-ssh.sh"
      },
      "type": [
        "object",
        {
          "auto_validation": "bool",
          "makefile_cmds": [
            "tuple",
            [
              "string",
              "string"
            ]
          ],
          "ssh_test_enabled": "bool",
          "test_script": "string"
        }
      ]
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "null_resource",
      "name": "ssh_test",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "2528651130084155481",
            "triggers": {
              "ip_address": "192.168.88.140",
              "vm_id": "740"
            }
          },
          "sensitive_attributes": [],
          "dependencies": [
            "proxmox_virtual_environment_download_file.ubuntu_cloud_image",
            "proxmox_virtual_environment_file.cloud_config",
            "proxmox_virtual_environment_vm.vm4_server"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_download_file",
      "name": "ubuntu_cloud_image",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "checksum": null,
            "checksum_algorithm": null,
            "content_type": "iso",
            "datastore_id": "local",
            "decompression_algorithm": null,
            "file_name": "ubuntu-22.04-cloud-vm4.img",
            "id": "local:iso/ubuntu-22.04-cloud-vm4.img",
            "node_name": "pve1",
            "overwrite": true,
            "overwrite_unmanaged": true,
            "size": 690464768,
            "upload_timeout": 300,
            "url": "https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64.img",
            "verify": true
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_file",
      "name": "cloud_config",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content_type": "snippets",
            "datastore_id": "local",
            "file_modification_date": null,
            "file_name": "vm4-server-cloud-init.yaml",
            "file_size": null,
            "file_tag": null,
            "id": "local:snippets/vm4-server-cloud-init.yaml",
            "node_name": "pve1",
            "overwrite": true,
            "source_file": [],
            "source_raw": [
              {
                "data": "#cloud-config\n# üöÄ Cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è VM4\n\n# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\nhostname: vm4-server\nmanage_etc_hosts: true\n\n# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏\nusers:\n  - name: devops\n    groups: [adm, sudo]\n    lock_passwd: false\n    sudo: ALL=(ALL) NOPASSWD:ALL\n    shell: /bin/bash\n    plain_text_passwd: vm4pass\n    chpasswd: { expire: false }\n    ssh_authorized_keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZ2PHxlsXJ4xpdvHqbkV68444NXMme4zC2Tv6Gdcl4cZPXJKJ2IGKli6OAS9Pc/iqL+qkwJBM49wZtZTiWURsNS/N2NkXGRKF8BBTMvds7lPuQXbA7lgWUmoslwz3//7ab/ZRngL7GyKwBxrh+/YB5jYavI2lsMkgsJZO0E7szc4cFjI+/dKTQ0rYuTlxxtc+6QkDVeuLGzbp+D/k1tall0mo1uZmiOwiUTrBq1WpkgS+cv9vvEGGsBP8tHoy07cjsu4wDcguNKTVSikPfAJ+3wONqT0Bno7qwBhkCknDBcMysxh7cZCLBKwXqo9Ycj4U06ejs2IkzZw1jRO/mmzBt macbook\n\n# SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\nssh_pwauth: true\ndisable_root: false\nssh_import_id: []\n\n# SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è\nssh:\n  emit_keys_to_console: false\n\n# –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\nwrite_files:\n  - path: /etc/netplan/01-netcfg.yaml\n    content: |\n      network:\n        version: 2\n        ethernets:\n          ens18:\n            dhcp4: false\n            addresses: [192.168.88.140/24]\n            gateway4: 192.168.88.1\n            nameservers:\n              addresses: [8.8.8.8, 1.1.1.1]\n    permissions: '0644'\n\n# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤\npackage_update: true\npackage_upgrade: true\n\n# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤\npackages:\n  - curl\n  - wget\n  - git\n  - vim\n  - htop\n  - net-tools\n  - qemu-guest-agent\n  - unzip\n  - tree\n  - nano\n  - docker.io\n  - docker-compose\n  - ca-certificates\n  - lsb-release\n  - gnupg\n\n# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\nwrite_files:\n  - content: |\n      #!/bin/bash\n      echo \"üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VM4...\"\n      \n      # –í–∫–ª—é—á–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—ã\n      systemctl enable qemu-guest-agent\n      systemctl start qemu-guest-agent\n      systemctl enable ssh\n      systemctl start ssh\n      \n      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH\n      \n      sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config\n      sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config\n      \n      systemctl restart ssh\n      \n      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏\n      netplan apply\n      \n      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall\n      ufw allow ssh\n      ufw allow 3000/tcp  # Grafana\n      ufw allow 9090/tcp  # Prometheus\n      ufw allow 9100/tcp  # Node Exporter\n      ufw --force enable\n      \n      # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP –µ—Å–ª–∏ DHCP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç\n      if ! ip route | grep default; then\n          ip addr add 192.168.88.140/24 dev ens18\n          ip route add default via 192.168.88.1\n      fi\n      \n      # –°–æ–∑–¥–∞–Ω–∏–µ welcome —Ñ–∞–π–ª–æ–≤\n      echo \"VM4 server ready!\" \u003e /home/devops/welcome.txt\n      echo \"SSH: devops@192.168.88.140\" \u003e\u003e /home/devops/welcome.txt\n      echo \"Password: vm4pass\" \u003e\u003e /home/devops/welcome.txt\n      chown devops:devops /home/devops/welcome.txt\n      chmod 644 /home/devops/welcome.txt\n      \n      # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ SSH\n      if [ -d \"/home/devops/.ssh\" ]; then\n          chmod 700 /home/devops/.ssh\n          chmod 600 /home/devops/.ssh/authorized_keys\n          chown -R devops:devops /home/devops/.ssh\n      fi\n      \n      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker\n      systemctl enable docker\n      systemctl start docker\n      usermod -aG docker devops\n      \n      # –°–æ–∑–¥–∞–Ω–∏–µ docker-compose.yml –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞\n      mkdir -p /home/devops/monitoring\n      cat \u003e /home/devops/monitoring/docker-compose.yml \u003c\u003c 'EOF'\nversion: '3.8'\n\nservices:\n  prometheus:\n    image: prom/prometheus:latest\n    container_name: prometheus\n    restart: unless-stopped\n    ports:\n      - \"9090:9090\"\n    volumes:\n      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml\n      - prometheus_data:/prometheus\n    command:\n      - '--config.file=/etc/prometheus/prometheus.yml'\n      - '--storage.tsdb.path=/prometheus'\n      - '--web.console.libraries=/etc/prometheus/console_libraries'\n      - '--web.console.templates=/etc/prometheus/consoles'\n      - '--web.enable-lifecycle'\n\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    restart: unless-stopped\n    ports:\n      - \"3000:3000\"\n    volumes:\n      - grafana_data:/var/lib/grafana\n      - ./grafana/provisioning:/etc/grafana/provisioning\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=admin123\n      - GF_SECURITY_ADMIN_USER=admin\n\n  node-exporter:\n    image: prom/node-exporter:latest\n    container_name: node-exporter\n    restart: unless-stopped\n    ports:\n      - \"9100:9100\"\n    volumes:\n      - /proc:/host/proc:ro\n      - /sys:/host/sys:ro\n      - /:/rootfs:ro\n    command:\n      - '--path.procfs=/host/proc'\n      - '--path.rootfs=/rootfs'\n      - '--path.sysfs=/host/sys'\n      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'\n\nvolumes:\n  prometheus_data:\n  grafana_data:\nEOF\n\n      # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus\n      mkdir -p /home/devops/monitoring/prometheus\n      cat \u003e /home/devops/monitoring/prometheus/prometheus.yml \u003c\u003c 'EOF'\nglobal:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nrule_files:\n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n\n  - job_name: 'node-exporter'\n    static_configs:\n      - targets: ['node-exporter:9100']\n      \n  - job_name: 'vm4-node'\n    static_configs:\n      - targets: ['192.168.88.140:9100']\nEOF\n\n      # –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Grafana\n      mkdir -p /home/devops/monitoring/grafana/provisioning/datasources\n      cat \u003e /home/devops/monitoring/grafana/provisioning/datasources/prometheus.yml \u003c\u003c 'EOF'\napiVersion: 1\n\ndatasources:\n  - name: Prometheus\n    type: prometheus\n    access: proxy\n    url: http://prometheus:9090\n    isDefault: true\nEOF\n\n      # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞\n      chown -R devops:devops /home/devops/monitoring\n      \n      echo \"‚úÖ VM4 –≥–æ—Ç–æ–≤–∞ —Å Grafana –∏ Prometheus!\"\n      echo \"üîê SSH: devops@192.168.88.140\"\n      echo \"üîë Password: vm4pass\"\n      echo \"üìä Grafana: http://192.168.88.140:3000 (admin/admin123)\"\n      echo \"üìà Prometheus: http://192.168.88.140:9090\"\n    path: /tmp/setup-vm4.sh\n    permissions: '0755'\n\n# –ö–æ–º–∞–Ω–¥—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ\nruncmd:\n  - /tmp/setup-vm4.sh\n  - sleep 30\n  - cd /home/devops/monitoring \u0026\u0026 docker-compose up -d\n\n# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\nfinal_message: \"üöÄ VM4 server is ready! Login with: ssh devops@192.168.88.140\"\n\n# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫\npower_state:\n  delay: \"+1\"\n  mode: reboot\n  message: \"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ VM4 –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SSH –Ω–∞—Å—Ç—Ä–æ–µ–∫\"\n  condition: true",
                "file_name": "vm4-server-cloud-init.yaml",
                "resize": 0
              }
            ],
            "timeout_upload": 1800
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "source_raw"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "data"
              }
            ]
          ],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "vm4_server",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [
              {
                "enabled": true,
                "timeout": "5m",
                "trim": false,
                "type": "virtio"
              }
            ],
            "audio_device": [],
            "bios": "seabios",
            "boot_order": null,
            "cdrom": [],
            "clone": [],
            "cpu": [
              {
                "architecture": "x86_64",
                "cores": 2,
                "flags": null,
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "qemu64",
                "units": 1024
              }
            ],
            "description": "üöÄ VM4 Production Server",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local",
                "discard": "on",
                "file_format": "qcow2",
                "file_id": "local:iso/ubuntu-22.04-cloud-vm4.img",
                "interface": "scsi0",
                "iothread": true,
                "path_in_datastore": "",
                "replicate": true,
                "size": 50,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "740",
            "initialization": [
              {
                "datastore_id": "local",
                "dns": [],
                "interface": "",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.88.140/24",
                        "gateway": "192.168.88.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [],
                "user_data_file_id": "local:snippets/vm4-server-cloud-init.yaml",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": null,
            "ipv6_addresses": null,
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": null,
            "machine": null,
            "memory": [
              {
                "dedicated": 4096,
                "floating": 0,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "vm4-server",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": null,
            "node_name": "pve1",
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": null,
            "protection": false,
            "reboot": false,
            "scsi_hardware": "virtio-scsi-pci",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "terraform",
              "vm4",
              "production"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 600,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 300,
            "timeout_shutdown_vm": 300,
            "timeout_start_vm": 600,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "vm_id": 740
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "proxmox_virtual_environment_download_file.ubuntu_cloud_image",
            "proxmox_virtual_environment_file.cloud_config"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
