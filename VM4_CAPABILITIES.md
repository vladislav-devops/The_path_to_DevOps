# üöÄ VM4 - –ü–æ–ª–Ω—ã–π –û–±–∑–æ—Ä –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ü—Ä–æ–µ–∫—Ç–∞

**VM4** - —ç—Ç–æ **—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è, –Ω–æ –º–æ—â–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è production-ready –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –Ω–∞ Proxmox. –ü—Ä–æ–µ–∫—Ç —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á.

### –§–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ **–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –≤—Å–µ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ, –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏–∑ –∫–æ—Ä–æ–±–∫–∏** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- ‚úÖ **Production-ready** - –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- ‚úÖ **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Grafana + Prometheus –≤–∫–ª—é—á–µ–Ω—ã
- ‚úÖ **–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```yaml
–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: Ubuntu 22.04 LTS (Jammy)
CPU: 2 cores (QEMU64)
RAM: 4096 MB (4 GB)
–î–∏—Å–∫: 50 GB (QCOW2 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π discard)
–°–µ—Ç—å: Static IP 192.168.123.140/24
VM ID: 740
Node: pve01
```

### –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```yaml
IP –∞–¥—Ä–µ—Å: 192.168.123.140
Gateway: 192.168.123.1
DNS: 8.8.8.8, 1.1.1.1
Bridge: vmbr0
Interface: ens18 (VirtIO)
```

---

## üí° –ß—Ç–æ –£–º–µ–µ—Ç VM4

### 1. üê≥ Docker & –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

VM4 –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º Docker**:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- Docker Engine (docker.io)
- Docker Compose
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å devops –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É docker
```

**–ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å:**
- –ó–∞–ø—É—Å–∫–∞—Ç—å –ª—é–±—ã–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å docker-compose –¥–ª—è multi-container –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
ssh devops@192.168.123.140
docker run hello-world
docker-compose up -d
```

---

### 2. üìä –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Grafana + Prometheus)

VM4 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç **–ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**:

#### Prometheus (–ø–æ—Ä—Ç 9090)
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∞–º–æ–≥–æ —Å–µ–±—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Node Exporter
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—ã

**–î–æ—Å—Ç—É–ø:**
```
URL: http://192.168.123.140:9090
–ë–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- CPU usage, Memory, Disk I/O
- Network traffic
- System load
- Process statistics

#### Grafana (–ø–æ—Ä—Ç 3000)
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
- –ì–æ—Ç–æ–≤—ã–π Prometheus datasource
- Web UI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤

**–î–æ—Å—Ç—É–ø:**
```
URL: http://192.168.123.140:3000
–õ–æ–≥–∏–Ω: admin
–ü–∞—Ä–æ–ª—å: admin123
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ custom –¥–∞—à–±–æ—Ä–¥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ alerts
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

#### Node Exporter (–ø–æ—Ä—Ç 9100)
- –≠–∫—Å–ø–æ—Ä—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ

**–î–æ—Å—Ç—É–ø:**
```
URL: http://192.168.123.140:9100/metrics
–§–æ—Ä–º–∞—Ç: Prometheus metrics
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  VM4 (192.168.123.140)              ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Grafana    ‚îÇ‚Üê‚îÄ‚îÇ  Prometheus  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  :3000      ‚îÇ  ‚îÇ  :9090       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                          ‚îÇ          ‚îÇ
‚îÇ                          ‚Üì          ‚îÇ
‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ                   ‚îÇ Node Export  ‚îÇ  ‚îÇ
‚îÇ                   ‚îÇ :9100        ‚îÇ  ‚îÇ
‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 3. üîê SSH –î–æ—Å—Ç—É–ø

VM4 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–≥–∏–±–∫—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é SSH**:

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É
```bash
# –ö–ª—é—á –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ terraform.tfvars
ssh devops@192.168.123.140
```

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –ø–∞—Ä–æ–ª—é
```bash
# –ü–∞—Ä–æ–ª—å: vm4pass (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ terraform.tfvars)
ssh devops@192.168.123.140
Password: vm4pass
```

#### SSH –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å sudo –ø—Ä–∞–≤–∞–º–∏ (NOPASSWD)
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω root login (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ authorized_keys
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ .ssh –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (700/600)

---

### 4. üî• Firewall (UFW)

VM4 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç **UFW firewall**:

**–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã:**
```bash
22/tcp   - SSH
3000/tcp - Grafana
9090/tcp - Prometheus
9100/tcp - Node Exporter
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- Firewall –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã
- –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```bash
ssh devops@192.168.123.140
sudo ufw status
sudo ufw allow 8080/tcp  # –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
sudo ufw delete allow 8080/tcp  # –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
```

---

### 5. üõ†Ô∏è –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

VM4 –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å **–±–æ–≥–∞—Ç—ã–º –Ω–∞–±–æ—Ä–æ–º —É—Ç–∏–ª–∏—Ç**:

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
```bash
curl          # HTTP –∫–ª–∏–µ–Ω—Ç
wget          # –ó–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤
git           # –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π
vim, nano     # –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã
htop          # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
net-tools     # –°–µ—Ç–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã (ifconfig, netstat)
tree          # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
unzip         # –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä
ca-certificates  # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
```

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–ª—É–∂–±—ã
```bash
qemu-guest-agent  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Proxmox
ssh               # SSH —Å–µ—Ä–≤–µ—Ä
docker            # Docker Engine
```

**–í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è!**

---

### 6. ü§ñ QEMU Guest Agent

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Proxmox:**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ IP –≤ Proxmox UI
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ shutdown/reboot –∏–∑ Proxmox
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
- –°–Ω–∏–º–∫–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (filesystem freeze)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è VM

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
# –°–ª—É–∂–±–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–µ–Ω–∞ –∏ –∑–∞–ø—É—â–µ–Ω–∞
systemctl status qemu-guest-agent
# ‚úÖ Active: active (running)
```

---

### 7. üåê –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –°–µ—Ç—å

VM4 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–Ω–∞–¥–µ–∂–Ω—É—é —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Å–µ—Ç–µ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:

**Netplan –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
network:
  version: 2
  ethernets:
    ens18:
      dhcp4: false
      addresses: [192.168.123.140/24]
      gateway4: 192.168.123.1
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π IP –∞–¥—Ä–µ—Å
- ‚úÖ –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç DHCP
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ production

**Fallback –º–µ—Ö–∞–Ω–∏–∑–º:**
```bash
# –ï—Å–ª–∏ netplan –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
ip addr add 192.168.123.140/24 dev ens18
ip route add default via 192.168.123.1
```

---

### 8. ‚òÅÔ∏è Cloud-init –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

VM4 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–æ—â–Ω—ã–π Cloud-init** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Cloud-init:**
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ hostname
2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è devops —Å sudo
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π
4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–∏ (netplan)
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
6. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —É—Ç–∏–ª–∏—Ç
7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall
8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker
9. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
10. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Prometheus/Grafana
11. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
12. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–õ–æ–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞:**
```bash
# –ù–∞ VM –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
ssh devops@192.168.123.140
sudo tail -f /var/log/cloud-init-output.log
```

---

### 9. üìù Welcome —Ñ–∞–π–ª

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è VM4 —Å–æ–∑–¥–∞–µ—Ç **–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª**:

```bash
ssh devops@192.168.123.140
cat welcome.txt

# –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
VM4 server ready!
SSH: devops@192.168.123.140
Password: vm4pass
```

**–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è:**
- –ë—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ VM –≥–æ—Ç–æ–≤–∞
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –¥–æ—Å—Ç—É–ø–∞
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ cloud-init

---

### 10. üß™ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

VM4 –≤–∫–ª—é—á–∞–µ—Ç **–∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:

#### Makefile –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
```bash
# –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help              # –°–ø—Ä–∞–≤–∫–∞
make init              # Terraform init
make plan              # Terraform plan
make apply             # –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å VM
make test-ping         # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
make test-ssh          # –ü–æ–ª–Ω–æ–µ SSH —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make deploy-and-test   # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ + —Ç–µ—Å—Ç—ã
make quick-deploy      # –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
make recreate          # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å VM
make destroy           # –£–¥–∞–ª–∏—Ç—å VM
make status            # –°—Ç–∞—Ç—É—Å VM
make clean             # –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
```

#### –°–∫—Ä–∏–ø—Ç test-ssh.sh
–í—ã–ø–æ–ª–Ω—è–µ—Ç **6 –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤**:

**–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏**
```bash
‚úÖ Ping VM (3 –ø–∞–∫–µ—Ç–∞)
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```

**–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –ø–æ—Ä—Ç–∞**
```bash
‚úÖ –ü–æ—Ä—Ç 22 –æ—Ç–∫—Ä—ã—Ç
‚úÖ SSH —Å–ª—É–∂–±–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**–¢–µ—Å—Ç 3: SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**
```bash
‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–ª—é—á—É
‚ö†Ô∏è Fallback –Ω–∞ –ø–∞—Ä–æ–ª—å
```

**–¢–µ—Å—Ç 4: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã**
```bash
‚úÖ whoami
‚úÖ hostname
‚úÖ uptime
```

**–¢–µ—Å—Ç 5: Cloud-init —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
```bash
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ welcome.txt
‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è cloud-init
```

**–¢–µ—Å—Ç 6: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã**
```bash
‚úÖ curl, git, vim, htop
‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
[2026-01-10 10:30:15] –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ VM4...
[2026-01-10 10:30:16] VM IP: 192.168.123.140
[2026-01-10 10:30:16] SSH Command: ssh devops@192.168.123.140
[2026-01-10 10:30:17] –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ ping...
‚úÖ VM –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å–µ—Ç–∏
[2026-01-10 10:30:20] –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –ø–æ—Ä—Ç–∞ (22)...
‚úÖ SSH –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç
[2026-01-10 10:30:22] –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –∫–ª—é—á–∞–º–∏...
‚úÖ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∫–ª—é—á–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
[2026-01-10 10:30:25] –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥...
‚úÖ –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ:
devops
vm4-server
 10:30:25 up 5 min,  1 user,  load average: 0.15, 0.25, 0.12
[2026-01-10 10:30:27] –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ cloud-init...
‚úÖ Cloud-init –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ: VM4 server ready!
[2026-01-10 10:30:29] –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤...
‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

[2026-01-10 10:30:30] üéâ SSH —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!
‚úÖ VM4 –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
[2026-01-10 10:30:30] –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ssh devops@192.168.123.140
```

---

### 11. üìä Terraform Outputs

VM4 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–¥–µ—Ç–∞–ª—å–Ω—ã–µ outputs**:

```bash
terraform output vm4_info
```

**–í—ã–≤–æ–¥:**
```json
{
  "name": "vm4-server",
  "ip_address": "192.168.123.140",
  "vm_id": 740,
  "ssh_command": "ssh devops@192.168.123.140",
  "status": "deployed",
  "created_at": "2026-01-10T10:25:00Z"
}
```

**–î—Ä—É–≥–∏–µ outputs:**
```bash
terraform output vm4_ssh_command
# ssh devops@192.168.123.140

terraform output vm4_config
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VM (CPU, RAM, Disk)

terraform output vm4_commands
# –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```

---

## üé¨ –°—Ü–µ–Ω–∞—Ä–∏–∏ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: Development Server
```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å VM4
cd vm4
terraform apply

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
ssh devops@192.168.123.140

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
git clone https://github.com/yourapp/app.git
cd app
npm install
npm start

# –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Grafana
# http://192.168.123.140:3000
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Docker Host
```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å VM4
cd vm4
terraform apply

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
ssh devops@192.168.123.140

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
cd /home/devops
cat > docker-compose.yml <<EOF
version: '3'
services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
  redis:
    image: redis:alpine
EOF

docker-compose up -d

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Prometheus
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: CI/CD Runner
```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å VM4
cd vm4
terraform apply

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å GitLab Runner
ssh devops@192.168.123.140
curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash
sudo apt-get install gitlab-runner
sudo gitlab-runner register

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ pipeline —á–µ—Ä–µ–∑ Grafana
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Monitoring Hub
```bash
# VM4 —É–∂–µ –∏–º–µ–µ—Ç Prometheus + Grafana

# –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ targets –≤ Prometheus
ssh devops@192.168.123.140
cd ~/monitoring/prometheus
vim prometheus.yml

# –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ targets:
scrape_configs:
  - job_name: 'web-servers'
    static_configs:
      - targets: ['server1:9100', 'server2:9100']

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
cd ~/monitoring
docker-compose restart prometheus

# –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –≤ Grafana
# http://192.168.123.140:3000
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: Database Server
```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å VM4
cd vm4
terraform apply

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL –≤ Docker
ssh devops@192.168.123.140
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=mysecret \
  -v pgdata:/var/lib/postgresql/data \
  -p 5432:5432 \
  postgres:15

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ë–î —á–µ—Ä–µ–∑ Prometheus exporter
docker run -d \
  --name postgres-exporter \
  -e DATA_SOURCE_NAME="postgresql://user:pass@postgres:5432/db?sslmode=disable" \
  -p 9187:9187 \
  prometheuscommunity/postgres-exporter

# –î–æ–±–∞–≤–∏—Ç—å –≤ Prometheus –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ Grafana
```

---

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

**–í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è: ~5-7 –º–∏–Ω—É—Ç**

```bash
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (10 —Å–µ–∫—É–Ω–¥)
cd vm4
terraform init

# 2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (5 —Å–µ–∫—É–Ω–¥)
terraform plan

# 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (2-3 –º–∏–Ω—É—Ç—ã)
terraform apply
# - –ó–∞–≥—Ä—É–∑–∫–∞ Ubuntu Cloud Image
# - –°–æ–∑–¥–∞–Ω–∏–µ cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# - –°–æ–∑–¥–∞–Ω–∏–µ VM
# - –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
# - Cloud-init –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

# 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (2-3 –º–∏–Ω—É—Ç—ã)
# - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
# - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ç–∏–ª–∏—Ç
# - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker
# - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

# 5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ (30 —Å–µ–∫—É–Ω–¥)
# - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SSH –Ω–∞—Å—Ç—Ä–æ–µ–∫

# 6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30 —Å–µ–∫—É–Ω–¥)
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
# - SSH —Ç–µ—Å—Ç—ã
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

# –ò–¢–û–ì–û: ~5-7 –º–∏–Ω—É—Ç –¥–æ –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

```bash
# –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—Å–µ–≥–æ
make deploy-and-test

# –ò–ª–∏ –µ—â–µ –ø—Ä–æ—â–µ
make quick-deploy

# –ò–ª–∏ —Å–æ–≤—Å–µ–º –ø—Ä–æ—Å—Ç–æ
terraform apply
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ú–µ—Ç—Ä–∏–∫–∏

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus

```promql
# CPU
node_cpu_seconds_total
rate(node_cpu_seconds_total[5m])

# Memory
node_memory_MemTotal_bytes
node_memory_MemAvailable_bytes

# Disk
node_disk_io_time_seconds_total
node_filesystem_avail_bytes

# Network
node_network_receive_bytes_total
node_network_transmit_bytes_total

# System
node_load1
node_load5
node_load15

# Docker (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å cAdvisor)
container_cpu_usage_seconds_total
container_memory_usage_bytes
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤

```promql
# CPU usage percentage
100 - (avg(rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# Memory usage percentage
(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100

# Disk usage percentage
(1 - (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"})) * 100

# Network traffic (incoming)
rate(node_network_receive_bytes_total{device="ens18"}[5m])
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **Firewall (UFW)**
   - –ê–∫—Ç–∏–≤–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
   - –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è

2. **SSH**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª—é—á–µ–π
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - Sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è –¥–ª—è devops

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏
   - –í—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ security –ø–∞—Ç—á–∏

4. **–ò–∑–æ–ª—è—Ü–∏—è**
   - Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
   - –û—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ—Ç—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
# 1. –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏
ssh devops@192.168.123.140
sudo passwd devops

# 2. –û–±–Ω–æ–≤–∏—Ç—å Grafana –ø–∞—Ä–æ–ª—å
# http://192.168.123.140:3000
# Profile > Change password

# 3. –û—Ç–∫–ª—é—á–∏—Ç—å password auth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –í terraform.tfvars:
# ssh_password_auth = false
# terraform apply

# 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π firewall
sudo ufw delete allow 3000/tcp
sudo ufw allow from 192.168.123.0/24 to any port 3000

# 5. –í–∫–ª—é—á–∏—Ç—å fail2ban
sudo apt install fail2ban
sudo systemctl enable fail2ban
```

---

## üéì –ß—Ç–æ –ú–æ–∂–Ω–æ –ò–∑—É—á–∏—Ç—å –Ω–∞ VM4

VM4 - –æ—Ç–ª–∏—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è:

### DevOps –ø—Ä–∞–∫—Ç–∏–∫–∏
- Infrastructure as Code (Terraform)
- Configuration Management (Cloud-init)
- Containerization (Docker)
- Monitoring (Prometheus/Grafana)
- Automation (Makefile, Bash)

### –°–∏—Å—Ç–µ–º–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- Linux –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–µ—Ç–µ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- Firewall —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- SSH –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- Package management

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- CI/CD pipeline
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- Performance tuning

---

## üí™ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ VM4

### –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
- ‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å**: 5 –º–∏–Ω—É—Ç vs 30-60 –º–∏–Ω—É—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- üéØ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- üìù **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –ö–æ–¥ = –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- üîÑ **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
- üß™ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

### –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å VM5
- üéØ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- üìñ **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å**: –õ–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å
- üöÄ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**: –ú–µ–Ω—å—à–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- üí° **–û–±—É—á–µ–Ω–∏–µ**: –•–æ—Ä–æ—à –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—Å–Ω–æ–≤

### –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å VM3 (–ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Prometheus + Grafana –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ README –∏ outputs

---

## üõ†Ô∏è –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ß—Ç–æ –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å

**–í terraform.tfvars:**
```hcl
proxmox_password = "your_password"
vm_user_password = "your_vm_password"
ssh_public_key = "your_ssh_key"
```

**–í main.tf (–ø—Ä–æ—Å—Ç—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è):**
```hcl
# CPU
cpu {
  cores = 4  # –ë—ã–ª–æ 2
}

# RAM
memory {
  dedicated = 8192  # –ë—ã–ª–æ 4096
}

# Disk
disk {
  size = 100  # –ë—ã–ª–æ 50
}

# IP –∞–¥—Ä–µ—Å
vm_ip_address = "192.168.123.200"
```

**–í cloud-init.tftpl (–¥–æ–±–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã):**
```yaml
packages:
  - curl
  - wget
  # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
  - nodejs
  - npm
  - python3-pip  # –î–æ–±–∞–≤–∏—Ç—å –Ω—É–∂–Ω—ã–µ
```

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¢–∞–±–ª–∏—Ü–∞: VM4 vs VM5

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | VM4 | VM5 |
|----------------|-----|-----|
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | –ü—Ä–æ—Å—Ç–∞—è | –°—Ä–µ–¥–Ω—è—è |
| **–§–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** | 1 main.tf | main.tf + variables.tf |
| **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** | 3 –æ—Å–Ω–æ–≤–Ω—ã–µ | 25+ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å (–±–æ–ª–µ–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π) |
| **Docker** | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å |
| **Firewall** | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ |
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** | –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è | –ú–æ–¥—É–ª—å–Ω–∞—è |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è** | –ë–∞–∑–æ–≤–∞—è | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | –•–æ—Ä–æ—à–∞—è | –û—Ç–ª–∏—á–Ω–∞—è |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** | Quick start | Production |
| **–û–±—É—á–µ–Ω–∏–µ** | –û—Ç–ª–∏—á–Ω–æ | –•–æ—Ä–æ—à–æ |
| **–ì–∏–±–∫–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è |

---

## üéØ –ö–æ–≥–¥–∞ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VM4

### –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Development –æ–∫—Ä—É–∂–µ–Ω–∏–π
- ‚úÖ –û–±—É—á–µ–Ω–∏—è Terraform
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç–µ–Ω–¥–æ–≤
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–π
- ‚úÖ CI/CD runners
- ‚úÖ –ù–µ–±–æ–ª—å—à–∏—Ö production –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ Docker —Ö–æ—Å—Ç–∏–Ω–≥–∞
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ö–∞–±–∞

### –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- ‚ùå –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VM5 —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ä–µ—Å—É—Ä—Å–æ–≤)
- ‚ùå –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö production —Å—Ä–µ–¥ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏)
- ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö VM (–Ω—É–∂–µ–Ω –º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ VM5)

---

## üìö –ò—Ç–æ–≥–æ–≤–∞—è –°–≤–æ–¥–∫–∞ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

**VM4 —ç—Ç–æ:**

1. **Production-ready —Å–µ—Ä–≤–µ—Ä** —Å Ubuntu 22.04
2. **Docker host** –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ö–∞–±** —Å Grafana + Prometheus
4. **Development –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞** —Å –≤—Å–µ–º–∏ —É—Ç–∏–ª–∏—Ç–∞–º–∏
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** —Å firewall –∏ SSH
6. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** —Å cloud-init
7. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** —Å –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏
8. **–õ–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è** —á–µ—Ä–µ–∑ Makefile
9. **–•–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** —Å outputs
10. **–ì–æ—Ç–æ–≤–∞—è –∑–∞ 5 –º–∏–Ω—É—Ç** –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üöÄ –ù–∞—á–∞–ª–æ –†–∞–±–æ—Ç—ã

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å/–ø–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç
cd vm4

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
terraform validate

# 3. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω
terraform plan

# 4. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å
terraform apply
# –ò–õ–ò
make deploy-and-test

# 5. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
ssh devops@192.168.123.140

# 6. –ù–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!
docker ps
cd ~/monitoring
curl http://localhost:3000  # Grafana
curl http://localhost:9090  # Prometheus

# 7. –ù–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è üéâ
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ Troubleshooting

### –õ–æ–≥–∏
```bash
# Cloud-init –ª–æ–≥
ssh devops@192.168.123.140
sudo tail -f /var/log/cloud-init-output.log

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–∏
cd ~/monitoring
docker-compose logs -f
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# Docker
sudo systemctl restart docker

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
cd ~/monitoring
docker-compose restart

# SSH
sudo systemctl restart ssh

# QEMU Agent
sudo systemctl restart qemu-guest-agent
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
# –°–µ—Ç–µ–≤–∞—è
ip addr show
ip route show
ping 8.8.8.8

# –°–µ—Ä–≤–∏—Å—ã
systemctl status docker
systemctl status ssh
docker ps

# –†–µ—Å—É—Ä—Å—ã
htop
df -h
free -h
```

---

**VM4 - –ü—Ä–æ—Å—Ç–æ–µ –∏ –ú–æ—â–Ω–æ–µ –†–µ—à–µ–Ω–∏–µ –¥–ª—è –í–∞—à–∏—Ö DevOps –ó–∞–¥–∞—á! üöÄ**
